<div class="p-4">

  <!-- Title -->
  <h1 class="text-3xl font-bold mb-6">My Task Categories</h1>

  <!-- New Task Button -->
  <%= link_to 'New Task', new_task_path, class: "btn btn-primary mb-4" %>

  <!-- Categories Grid -->
  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-8">
    <% @categories.each do |category| %>
      <%= link_to by_category_tasks_path(category: category), class: "p-4 rounded-xl bg-base-100 shadow hover:shadow-md transition block text-center" do %>
        <div class="text-5xl mb-2">📁</div>
        <div class="text-lg font-semibold truncate">
          <%= category.presence || "ไม่ระบุหมวดหมู่" %>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Tasks by Category -->
  <h2 class="text-2xl font-bold mb-4">Tasks by Category</h2>

  <% @tasks.group_by(&:category).each do |category, tasks| %>
    <div class="bg-base-200 p-4 rounded-xl mb-6">
      <h3 class="text-xl font-semibold mb-2">
        <%= category.presence || "ไม่ระบุหมวดหมู่" %>
      </h3>
      <ul class="space-y-2">
        <% tasks.each do |task| %>
          <li class="flex justify-between items-center <%= 'line-through text-gray-400' if task.done %>">
            <div>
              <%= link_to task.title, task_path(task), class: "font-medium hover:underline" %>
              <% if task.deadline %>
                <span class="text-sm text-gray-500 ml-2">📅 <%= task.deadline.strftime("%d/%m/%Y") %></span>
              <% end %>
            </div>
            <div>
              <%= form_with model: task, url: toggle_done_task_path(task), method: :patch, local: true do |f| %>
                <%= f.check_box :done, { checked: task.done, onchange: 'this.form.submit()' }, true, false %>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

</div>
